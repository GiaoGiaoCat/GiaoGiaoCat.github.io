---
layout: post
title:  "面向对象设计实践指南 7 - 使用模块共享角色行为"
date:   2015-01-12 16:30:00
categories: ruby
tags: learningnote refactoring
author: "Victor"
---

## 理解角色

有时候需要在不相关的对象之间共享行为。

前面介绍的 Preparer 就是一个角色。那些实现了 `preparer` 接口的对象扮演了这个角色。而 Preparer 角色的存在表明了还存在有一个平行的 Preparable 角色。该接口包含了 Preparer 希望发送给 Preparable 的所有信息，也就是 `bicycles, customers, vehicle`。

尽管 Preparer 角色有多个演员，但它非常简单，直接通过接口来定义就行。为了扮演这个角色，对象只需要实现自己的 `prepare_trip` 方法。

但是实际项目中我们往往会发现很多复杂的角色，它们不仅需要特定的消息，还包括特定的行为。当某个角色需要共享行为时，我们就面临着组织代码的问题。在理想情况下，代码应该只定义在一个地方，而任何希望表现得像鸭子类型的对象都可以使用它。

在 Ruby 中，这类混入内容都被称为模块 `module`，它允许你一次定义一组命名方法，这些命名方法独立于类，并且可以混入到任何对象。

### 里氏替换原则 LSP

* 该原则在数学上被表述为：子类型应该能够替换它的父类型
* 在 Ruby 里它表示的是：对象应该言行一致

## 小结

当扮演公共角色的对象需要共享行为时，可以通过 Ruby 的模块实现。模块里定义的代码可以添加到任何对象，其中包括类实例、类本身或者另一个模块。

模块应该使用模板方法模式，从而让哪些包含它们的类型可以提供自己特殊化的内容。模块也应该实现钩子方法，以避免那些混入了模块的类型必须发送 `super` 消息才能知道算法。
